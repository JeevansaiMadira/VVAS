<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Smart Model Select Application &mdash; Vitis™ Video Analytics SDK 3.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Multichannel ML" href="Tutorials/MultiChannelML.html" />
    <link rel="prev" title="Platforms And Applications" href="platforms_and_applications.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../index.html" class="icon icon-home"> Vitis™ Video Analytics SDK
            <img src="../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Base Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../common/gstreamer_plugins/common_plugins.html">VVAS GStreamer Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/meta_data/vvas_meta_data_structures.html">VVAS Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/for_developers.html">VVAS For Advanced Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../common/debug_support.html">VVAS Debug Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="platforms_and_applications.html">Platforms &amp; Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="platforms_and_applications.html#som-examples">SOM Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="platforms_and_applications.html#zcu104-examples">ZCU104 Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Smart Model Select</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparing-the-setup">Preparing the setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-application">Running the application</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-design">Build Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compiling-hardware-accelerators-kernels">Compiling Hardware Accelerators (Kernels)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-sd-card-image">Creating SD Card image</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-vvas-plug-ins-and-libraries">Build VVAS Plug-ins and Libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="Tutorials/MultiChannelML.html">Multi Channel ML</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="embedded-plugins.html">VVAS GStreamer Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Center</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DC/platforms_and_applications.html">Platforms &amp; Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Vitis™ Video Analytics SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="platforms_and_applications.html">Platforms And Applications</a> &raquo;</li>
      <li>Smart Model Select Application</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/docs/Embedded/smart_model_select.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="smart-model-select-application">
<h1>Smart Model Select Application<a class="headerlink" href="#smart-model-select-application" title="Permalink to this headline">¶</a></h1>
<p>Smart Model Select is an example application to demonstrate inferencing using 8 Machine Learning (ML) models supported by VVAS. User can select the input source, ML model to be used and the output option, like display on monitor or dump the results to file.</p>
<p>Smart Model Select application design is built on <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> development board which, along with VVAS, provides a complete framework for building and customizing video platforms with different pipelines stages. <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> development board can support below mentioned pipeline stages:</p>
<ul class="simple">
<li><p>Capture Pipelines</p></li>
<li><p>Video Processing Pipelines</p></li>
<li><p>Acceleration Pipelines</p></li>
<li><p>Output Pipelines</p></li>
</ul>
<p>Smart Model Select design does not support Capture Pipeline.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<p>Smart Model Select application supports below mentioned features</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supported Models are listed below. For more information please contact <a class="reference external" href="mailto:vvas_discuss&#37;&#52;&#48;amd&#46;com">vvas_discuss<span>&#64;</span>amd<span>&#46;</span>com</a>.</p>
</div>
<ul class="simple">
<li><p>Supports ML Models
- refinedet_VOC_tf
- efficientdet_d2_tf
- ssd_mobilenet_v2_coco_tf
- yolov3_voc_tf
- face_mask_detection_pt
- chen_color_resnet18_pt
- vehicle_make_resnet18_pt
- vehicle_type_resnet18_pt</p></li>
<li><p>Display Port for display</p></li>
<li><p>H264/H265 Decode</p></li>
<li><p>Input can be from file or rtsp source</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>Before attempting the execution of application, please ensure that all the pre-requisites mentioned below are fulfilled.</p>
<div class="section" id="hardware-requirements">
<h3>Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://www.xilinx.com/products/boards-and-kits/zcu104.html">ZCU104 Evaluation Board Rev 1.0</a></p></li>
<li><p>Micro USB cable, connected to laptop or desktop computer for the terminal emulator</p></li>
<li><p>Micro SD card, 8 GB or larger, class 10 (recommended)</p></li>
<li><p>Display port 1.2 supported Monitor with 1920x1080 as max resolution</p></li>
<li><p>Display port 1.2 cable</p></li>
</ul>
</div>
<div class="section" id="software-tools-requirements">
<h3>Software/Tools Requirements<a class="headerlink" href="#software-tools-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Serial terminal emulator (for example, Tera Term)</p></li>
<li><p>Balena etcher or equivalent flashing tool to flash the SD Card image</p></li>
</ul>
</div>
<div class="section" id="system-requirements">
<h3>System Requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Board must have access to the internet and be accessible from your development system</p></li>
</ul>
</div>
<div class="section" id="application-design">
<h3>Application Design<a class="headerlink" href="#application-design" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> application design has a platform and integrated accelerator functions.
Platform is nothing but collection of hardware as well as software components required to build a solution.
Prebuilt design for <code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> has been provided as part of this VVAS release.
You may download this ready to use design by following the link <a class="reference internal" href="#prebuilt-binaries"><span class="std std-ref">Download pre-built binaries</span></a> and
directly jump to <a class="reference internal" href="#preparing-setup"><span class="std std-ref">Preparing Setup</span></a> section describing how to prepare the setup and execute the example application.</p>
<p>If for some reason, one wants to build the design from scratch, then refer to the section <a class="reference internal" href="#build-platform"><span class="std std-ref">Build Design</span></a> that describes the steps to build the platform, accelerator functions and finally integrate these to create complete Design for <cite>Smart Model Select</cite> application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>VVAS platform <code class="docutils literal notranslate"><span class="pre">zcu104_vcuDec_DP</span></code> may not be performance optimal. This platform is made available as reference along with <cite>Smart Model Select Application</cite>.</p>
</div>
</div>
<div class="section" id="pre-built-binaries">
<span id="prebuilt-binaries"></span><h3>Pre-built binaries<a class="headerlink" href="#pre-built-binaries" title="Permalink to this headline">¶</a></h3>
<p>Ready to use Prebuilt binaries are provided with this VVAS release. You can download these binaries and required supporting files to quickly run the example application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pre-built binaries for this example design are available at the link mentioned below. You may also build the complete example design following the steps mentioned in <strong>Build Design</strong> section. For more information, you may contact <a class="reference external" href="mailto:vvas_discuss&#37;&#52;&#48;amd&#46;com">vvas_discuss<span>&#64;</span>amd<span>&#46;</span>com</a>.</p>
</div>
<p>Create a folder, say <cite>PREBUILT_BINARIES</cite>, where pre-built binaries are to be downloaded.</p>
<blockquote>
<div><p>Download from <a class="reference external" href="https://www.xilinx.com/member/forms/download/xef.html?filename=vvas_smart_model_select_2022.2_zcu104.zip">vvas_smart_model_select_2022.2_zcu104.zip</a> and unzip the downloaded package <cite>vvas_smart_model_select_2022.2_zcu104.zip</cite>.</p>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span> <span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p>Prebuilt binaries package includes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sd_card.img</span></code>: Image to be flashed on the SD Card on the zcu104 board.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sdk.sh</span></code>: This is required to generate sysroot. Sysroot is required <strong>only</strong> if one wants to build the VVAS plugins and
libraries. You do not need this if you simply want to execute the pre-built application.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">models</span></code>: label.json files for the supported DPU models on this platform.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">app</span></code>: Contains application executable and input configuration/json files.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">arch.json</span></code>: Represents DPU architecture.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pre-buit binaries available for download from the link mentioned above contain software copyrighted by Xilinx and third parties subject to one or more open source software licenses that are contained in the source code files available for download at the link mentioned below.  Please see the source code for the copyright notices and licenses applicable to the software in these binary files.  By downloading these binary files, you agree to abide by the licenses contained in the corresponding source code</p>
</div>
<div class="section" id="open-source-licenses-and-source-code-vvas-3-0">
<h4>Open-Source Licenses and Source code - VVAS 3.0<a class="headerlink" href="#open-source-licenses-and-source-code-vvas-3-0" title="Permalink to this headline">¶</a></h4>
<p>The source code that was used to build these pre-built binaries and the corresponding licenses can be downloaded from <a class="reference external" href="https://www.xilinx.com/bin/public/openDownload?filename=license_and_sources_for_smart_model_select.tar.gz">Source Licenses and Source Code</a></p>
<p>Once you have downloaded the prebuilt binaries, you need to prepare the setup to execute the application, as shown in the next section.</p>
</div>
</div>
</div>
<div class="section" id="preparing-the-setup">
<span id="preparing-setup"></span><h2>Preparing the setup<a class="headerlink" href="#preparing-the-setup" title="Permalink to this headline">¶</a></h2>
<p>It is assumed that all the pre-requisites are fulfilled, and we are ready to setup the board and execute the example application. There are few steps that are required only for the first time when the <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> board is not flashed with the sd_card image for <code class="docutils literal notranslate"><span class="pre">smart_model_select</span></code> application. You may skip these steps if <code class="docutils literal notranslate"><span class="pre">zcu104</span></code> board has already been flashed with the required sd_card image.</p>
<div class="section" id="one-time-setup">
<h3>One time setup<a class="headerlink" href="#one-time-setup" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Flash the SD Card with the <code class="docutils literal notranslate"><span class="pre">sd_card.img</span></code> using any SD card flashing tool like dd, Win32DiskImager, or BalenaEtcher.</p>
<p>If using pre-built binaries, then sd_card.img is located as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">sd_card</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
<p>If you have built the platform yourself, then sd_card.img would be located at</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">examples</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">smart_model_select</span><span class="o">/</span><span class="n">binary_container_1</span><span class="o">/</span><span class="n">sd_card</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
</li>
<li><p>Insert this SD card in the SD card slot on the zcu104 board and boot the board.</p></li>
<li><p>After booting up the board, run below command to extend the root filesystem partition to its 100% size. This is useful
in copying input video streams and storing output files from example application.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">resize</span><span class="o">-</span><span class="n">part</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mmcblk0p2</span>
</pre></div>
</div>
</li>
<li><p>Copy the <cite>&lt;PREBUILT_BINARIES&gt;/vvas_smart_model_select_2022.2_zcu104/app</cite> folder of the application onto <cite>home</cite> folder of the board.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">app</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">board</span> <span class="n">ip</span><span class="o">&gt;</span><span class="p">:</span><span class="o">~/</span>
</pre></div>
</div>
</li>
<li><p>After copying, <code class="docutils literal notranslate"><span class="pre">chmod</span></code> <cite>~/app/setup.sh</cite> and <cite>~/app/smart_model_select</cite> to make them executable on the board.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="mi">777</span> <span class="o">~/</span><span class="n">app</span><span class="o">/</span><span class="n">smart_model_select</span>
<span class="n">chmod</span> <span class="mi">777</span> <span class="o">~/</span><span class="n">app</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>On the host, download and untar the Vitis-AI models:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mkdir &lt;PREBUILT_BINARIES&gt;/models
cd &lt;PREBUILT_BINARIES&gt;/models

wget https://www.xilinx.com/bin/public/openDownload?filename=refinedet_VOC_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf refinedet_VOC_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=efficientdet_d2_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf efficientdet_d2_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=ssd_mobilenet_v2_coco_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf ssd_mobilenet_v2_coco_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=yolov3_voc_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf yolov3_voc_tf-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=face_mask_detection_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf face_mask_detection_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=chen_color_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf chen_color_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=vehicle_make_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf vehicle_make_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
wget https://www.xilinx.com/bin/public/openDownload?filename=vehicle_type_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
tar xzf vehicle_type_resnet18_pt-zcu102_zcu104_kv260-r3.0.0.tar.gz
</pre></div>
</div>
</li>
<li><p>Modify the ‘top_k’ in ‘prototxt’ files for the below required models:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s!top_k : 5!top_k : 1!&#39;</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">models</span><span class="o">/</span><span class="n">chen_color_resnet18_pt</span><span class="o">/</span><span class="n">chen_color_resnet18_pt</span><span class="o">.</span><span class="n">prototxt</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s!top_k : 5!top_k : 1!&#39;</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">models</span><span class="o">/</span><span class="n">vehicle_make_resnet18_pt</span><span class="o">/</span><span class="n">vehicle_make_resnet18_pt</span><span class="o">.</span><span class="n">prototxt</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s!top_k : 5!top_k : 1!&#39;</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">models</span><span class="o">/</span><span class="n">vehicle_make_resnet18_pt</span><span class="o">/</span><span class="n">vehicle_make_resnet18_pt</span><span class="o">.</span><span class="n">prototxt</span>
</pre></div>
</div>
</li>
<li><p>Create <cite>/usr/share/vitis_ai_library/models</cite> folder on the board and copy the Vitis-AI models into it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">vitis_ai_library</span><span class="o">/</span><span class="n">models</span>
<span class="n">scp</span> <span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">models</span><span class="o">/*</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">board</span> <span class="n">ip</span><span class="o">&gt;/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">vitis_ai_library</span><span class="o">/</span><span class="n">models</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>Copy label.json for each model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">face_mask_detection_pt</span><span class="o">/</span><span class="n">label</span><span class="o">.</span><span class="n">json</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">board</span> <span class="n">ip</span><span class="o">&gt;/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">vitis_ai_library</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">face_mask_detection_pt</span><span class="o">/</span>
<span class="n">scp</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">ssd_mobilenet_v2_coco_tf</span><span class="o">/</span><span class="n">label</span><span class="o">.</span><span class="n">json</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">board</span> <span class="n">ip</span><span class="o">&gt;/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">vitis_ai_library</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">ssd_mobilenet_v2_coco_tf</span><span class="o">/</span>
<span class="n">scp</span> <span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">yolov3_voc_tf</span><span class="o">/</span><span class="n">label</span><span class="o">.</span><span class="n">json</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">board</span> <span class="n">ip</span><span class="o">&gt;/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">vitis_ai_library</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">yolov3_voc_tf</span><span class="o">/</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="running-the-application">
<h2>Running the application<a class="headerlink" href="#running-the-application" title="Permalink to this headline">¶</a></h2>
<p>This section will elaborate on the usage of the application and various options with it.</p>
<p>Every time the board is booted, execute the steps mentioned below</p>
<ul>
<li><p>Run <cite>setup.sh</cite> on the board, this will set the alpha channel of the display port and copy label json files related
to each model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">app</span><span class="o">/</span>
<span class="o">./</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>Export the environment variable “XCLBIN_PATH” with path pointing to xclbin. If it is not exported, <cite>/media/sd-mmcblk0p1/dpu.xclbin</cite> will be the default xclbin path.</p></li>
<li><p>Run the command to execute the application
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">smart_model_select</span>
</pre></div>
</div>
</li>
</ul>
<p>When the application starts executing, you can observe the Fig 1 coming up in the display. This menu displays various models supported by the application and options on either side of the image are for input sources and output sinks supported. All these options carry an index number alongside, which user need to enter in sequence to create the pipeline of choice.</p>
<img alt="../../_images/ExampleAppMenu.png" src="../../_images/ExampleAppMenu.png" />
<p>Fig 1: Menu image of the application</p>
<p>When application is started, a command prompt will appear on the console. This prompt will accept the input options for creating the GStreamer pipeline of choice. As described below, user must enter four options in the sequence of input source, ML model to be used, output sink type and a field to enable/disable performance mode. For example, the sequence “1,2,3,0”, means that the source is “filesrc”, ML model to be used is “refinedet_VOC_tf”, sink is “kmssink” and 0 is to disable performance mode.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span>
<span class="n">Menu</span> <span class="n">displayed</span> <span class="n">on</span> <span class="n">the</span> <span class="n">monitor</span> <span class="n">shows</span> <span class="n">various</span> <span class="n">options</span> <span class="n">available</span>
<span class="k">for</span> <span class="nb">input</span> <span class="n">source</span><span class="p">,</span> <span class="n">ML</span> <span class="n">model</span><span class="p">,</span> <span class="n">output</span> <span class="n">sink</span><span class="o">.</span> <span class="n">Each</span> <span class="n">option</span> <span class="n">carries</span> <span class="n">an</span>
<span class="n">index</span> <span class="n">number</span> <span class="n">alongside</span><span class="o">.</span>
<span class="n">Select</span> <span class="n">elements</span> <span class="n">to</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">pipeline</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">sequence</span> <span class="n">of</span>
<span class="s2">&quot;input source, ML model, output sink and performance</span>
<span class="n">mode</span> <span class="n">flag</span><span class="s2">&quot; separated by commas.</span>
<span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="nb">input</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span>
<span class="n">Above</span> <span class="nb">input</span> <span class="n">will</span> <span class="n">run</span> <span class="s2">&quot;filesrc&quot;</span> <span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;refinedet_VOC_tf&quot;</span> <span class="n">model</span>
<span class="s2">&quot;kmssink&quot;</span> <span class="n">used</span> <span class="k">as</span> <span class="n">output</span> <span class="n">sink</span> <span class="ow">and</span> <span class="n">performance</span> <span class="n">mode</span> <span class="n">disabled</span><span class="o">.</span>
<span class="n">Enter</span> <span class="s1">&#39;q&#39;</span> <span class="n">to</span> <span class="n">exit</span>
<span class="n">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If performance mode is enabled, then the sink type should always be <code class="docutils literal notranslate"><span class="pre">fakesink</span></code>. Otherwise, pipeline will not execute.</p>
<p>If performance mode is enabled, there will be 4 ML pipelines executed simultaneously feeding DPU from multiple threads. This results in improved performance compared to when using DPU from single thread.</p>
<p>In the GStreamer pipelines in this application, Sync is disabled. Which means frames are sent to the display at the rate at which these are processed by pipeline. Hence for smaller resolution streams, you may observe that frames are displayed at faster than real time rate.</p>
</div>
<p>Followed by the selection of ML model, source and sink elements, next step is the option to provide input filename or RTSP URL as applicable, to be processed.</p>
<p>If the selected input is file source, then by default application will look for the input video files under <cite>app/videos</cite> folder.
Create the folder <code class="docutils literal notranslate"><span class="pre">/home/root/app/videos</span></code> and copy the video files here with names given below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">videos</span><span class="o">/</span>
<span class="o">+--</span> <span class="n">REFINEDET_VOC_TF</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">EFFICIENTDET_D2_TF</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">SSD_MOBILENET_V2_COCO_TF</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">YOLOV3_VOC_TF</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">FACE_MASK_DETECTION_PT</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">CHEN_COLOR_RESNET18_PT</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">VEHICLE_MAKE_RESNET18_PT</span><span class="o">.</span><span class="n">mp4</span>
<span class="o">+--</span> <span class="n">VEHICLE_TYPE_RESNET18_PT</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<p>If the file is not available in this folder, then application will prompt for the input file. All files must be named after ML model type as given below.
User has to enter the input file location in response to the below message prompt.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">filename</span> <span class="n">to</span> <span class="n">be</span> <span class="n">processed</span>
</pre></div>
</div>
<p>If the selected input source is “RTSP”, then application will prompt for entering “RTSP” URL.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enter</span> <span class="n">the</span> <span class="n">RTSP</span> <span class="n">url</span> <span class="n">to</span> <span class="n">be</span> <span class="n">processed</span>
</pre></div>
</div>
<p>The application supports RTSP input with RTP packets containing H264 payload of resolution 1920x1080. One can download and setup GStreamer RTSP server or VLC can also be used to serve RTSP data. Follow below mentioned steps to compile GStreamer RTSP server. For successful compilation of GStreamer RTSP server, GStreamer framework must be installed as a prerequisite.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span>  <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gstreamer</span><span class="o">.</span><span class="n">freedesktop</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">gst</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">gst</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mf">1.18.5</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="mf">2.</span>  <span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">gst</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mf">1.18.5</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="mf">3.</span>  <span class="n">cd</span> <span class="n">gst</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mf">1.18.5</span><span class="o">/</span>
<span class="mf">4.</span>  <span class="o">./</span><span class="n">autogen</span><span class="o">.</span><span class="n">sh</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">gtk</span><span class="o">-</span><span class="n">doc</span>
<span class="mf">5.</span>  <span class="n">make</span>
</pre></div>
</div>
<p>Examples in gst-rtsp-server-1.18.5/examples can be used to serve RTSP data. Refer below example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gst</span><span class="o">-</span><span class="n">rtsp</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="mf">1.18.5</span><span class="o">/</span><span class="n">examples</span>
<span class="o">./</span><span class="n">test</span><span class="o">-</span><span class="n">launch</span>  <span class="s2">&quot;filesrc location=&lt;Absolute Path of File with H264 1080p in MP4 format&gt; ! qtdemux  ! h264parse ! rtph264pay name=pay0 pt=96&quot;</span>
</pre></div>
</div>
<p>Streaming starts on the URL <a class="reference external" href="rtsp:/">rtsp:/</a>/&lt;RTSP server ip adress&gt;:8554/test. Enter the same URL as input to the application.</p>
<p>Application supports multiple sink options as well. If <code class="docutils literal notranslate"><span class="pre">kmssink</span></code> is used, output video will be rendered on the display monitor connected. If <code class="docutils literal notranslate"><span class="pre">filesink</span></code> is chosen, the output will get dumped to a file by name “output.nv12” in the current directory. On the other hand, <code class="docutils literal notranslate"><span class="pre">fakesink</span></code> acts a black hole for the data with no overhead.</p>
<p>Below Fig 2 is the pictorial depiction of a typical pipeline that is created by the application.</p>
<img alt="../../_images/ExamplePipeline.png" src="../../_images/ExamplePipeline.png" />
<p>Fig 2: Typical GStreamer pipeline that application creates</p>
</div>
<div class="section" id="build-design">
<span id="build-platform"></span><h2>Build Design<a class="headerlink" href="#build-design" title="Permalink to this headline">¶</a></h2>
<p>The Design consists of a base platform and integrated accelerator functions (Kernels).</p>
<div class="section" id="base-platform">
<h3>Base Platform<a class="headerlink" href="#base-platform" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> application requires video decoding, resizing the decoded frames, Machine Learning and finally display the output. Hence, we need a platform that fulfills these requirements. This VVAS release has <code class="docutils literal notranslate"><span class="pre">zcu104_vcuDec_DP</span></code> base platform that meets the requirements of decode and display. This platform has hardware accelerated video decoding IP, Video Codec Unit <code class="docutils literal notranslate"><span class="pre">VCU</span></code>. For display, this platform supports <code class="docutils literal notranslate"><span class="pre">Display</span> <span class="pre">Port</span></code>. The design also includes two DPU 4096 cores for Machine Learning.</p>
<p>In addition to the above-mentioned hardware components, <code class="docutils literal notranslate"><span class="pre">zcu104_vcuDec_DP</span></code> supports following software components</p>
<ul class="simple">
<li><p>omxh264dec GStreamer plugin</p></li>
<li><p>Opensource framework like GStreamer, OpenCV</p></li>
<li><p>Vitis AI 3.0 libraries</p></li>
<li><p>Xilinx Run Time (XRT)</p></li>
</ul>
</div>
<div class="section" id="compiling-base-platform">
<h3>Compiling base platform<a class="headerlink" href="#compiling-base-platform" title="Permalink to this headline">¶</a></h3>
<p>Complete sources along with workspace to build the platform is provided as part of this release.
Follow the steps mentioned below to compile the platform.</p>
<ol class="arabic">
<li><p>Navigate to the folder, such as <code class="docutils literal notranslate"><span class="pre">VVAS_SOURCES</span></code>, where you want to clone the VVAS source tree.</p></li>
<li><p>Clone VVAS repo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Xilinx</span><span class="o">/</span><span class="n">VVAS</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</li>
<li><p>Setup tool chain environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">&lt;</span><span class="mf">2022.2</span><span class="n">_Vitis</span><span class="o">&gt;/</span><span class="n">settings64</span><span class="o">.</span><span class="n">sh</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="mf">2022.2</span><span class="n">_Petalinux</span><span class="o">&gt;/</span><span class="n">settings</span><span class="o">.</span><span class="n">sh</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="mf">2022.2</span><span class="n">_Vivado</span><span class="o">&gt;/</span><span class="n">setenv</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">zcu104_vcuDec_DP</span></code> platform folder:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">platforms</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">zcu104_vcuDec_DP</span>
</pre></div>
</div>
</li>
<li><p>Compile the platform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
</li>
</ol>
<p id="platform-path">After build is finished, platform will be available <code class="docutils literal notranslate"><span class="pre">&lt;VVAS_SOURCES&gt;/VVAS/vvas-platforms/Embedded/zcu104_vcuDec_DP/platform_repo/xilinx_zcu104_vcuDec_DP_202220_1/export/xilinx_zcu104_vcuDec_DP_202220_1/</span></code> location.</p>
</div>
<div class="section" id="hardware-accelerators-kernels">
<h3>Hardware Accelerators (Kernels)<a class="headerlink" href="#hardware-accelerators-kernels" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> application’s requirements of Machine Learning and Resize operations are fulfilled by below mentioned accelerators (Kernels):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DPU</span></code> (Deep Learning Processing Unit) for Machine Learning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Image</span> <span class="pre">Processing</span></code> for Preprocessing operation</p></li>
</ul>
</div>
</div>
<div class="section" id="compiling-hardware-accelerators-kernels">
<h2>Compiling Hardware Accelerators (Kernels)<a class="headerlink" href="#compiling-hardware-accelerators-kernels" title="Permalink to this headline">¶</a></h2>
<p>The sources for hardware accelerators required for <code class="docutils literal notranslate"><span class="pre">Smart</span> <span class="pre">Model</span> <span class="pre">Select</span></code> application can be made available as mentioned below:</p>
<ol class="arabic simple">
<li><p>Navigate to &lt;VVAS_SOURCES&gt;</p></li>
<li><p>DPU Kernel sources can be obtained by following steps as below:</p></li>
</ol>
<blockquote>
<div><ul>
<li><p>Open the <a class="reference external" href="https://github.com/Xilinx/Vitis-AI/tree/master/dpu#readme">reference_design</a> readme page from Vitis-AI release repo.</p></li>
<li><p>Copy the <strong>Reference Design</strong> link for <strong>IP Name</strong> corresponding to <code class="docutils literal notranslate"><span class="pre">DPUCZDX8G</span></code> from <code class="docutils literal notranslate"><span class="pre">Edge</span> <span class="pre">IP</span></code> Table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="n">DPUCZDX8G_VAI_v3</span><span class="mf">.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="s1">&#39;&lt;Download Link&gt;&#39;</span>
</pre></div>
</div>
</li>
<li><p>Unarchive <code class="docutils literal notranslate"><span class="pre">DPUCZDX8G_VAI_v3.0.tar.gz</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xf</span> <span class="n">DPUCZDX8G_VAI_v3</span><span class="mf">.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<ol class="arabic" start="3">
<li><p>Image Processing kernel sources are part of VVAS source tree and are located at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">accel</span><span class="o">-</span><span class="n">hw</span><span class="o">/</span><span class="n">image_processing</span>
</pre></div>
</div>
</li>
</ol>
<p>Kernels may have different configurations for different application requirements. Hence it is recommended to build the Kernels from the application design workspace with the required Kernel configuration for that application.</p>
<p>Each application design workspace provided with this VVAS release has the required Kernel configurations for that application.</p>
<p>In case one wants to change the kernel configuration for some reason, do these changes in the configuration files mentioned below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Compilation of Kernels is initiated from the build process of the final design for the application. Hence kernel compilation steps are not covered separately here.</p>
</div>
<p>DPU Kernel for this example design is configured for B4096 architecture. Configuration file used can be found at <code class="docutils literal notranslate"><span class="pre">&lt;VVAS_SOURCES&gt;/VVAS/vvas-examples/Embedded/multichannel_ml/dpu_conf.vh</span></code>.</p>
<p>Image Processing IP/Kernel source code can be refered from <code class="docutils literal notranslate"><span class="pre">&lt;VVAS_SOURCES&gt;/VVAS/vvas-accel-hw/image_processing/</span></code>. For this example design Image Processing kernel is configured for max-width:1920, max-height:1080 and format support of Y_UV8_420, RGB and BGR. Configuration file used can be found at <code class="docutils literal notranslate"><span class="pre">&lt;VVAS_SOURCES&gt;/VVAS/vvas-examples/Embedded/multichannel_ml/image_processing_config.h</span></code>.</p>
<p>You may modify the kernel configuration as per your requirements in corresponding configuration files.</p>
</div>
<div class="section" id="creating-sd-card-image">
<h2>Creating SD Card image<a class="headerlink" href="#creating-sd-card-image" title="Permalink to this headline">¶</a></h2>
<p>Once platform is built, next step is to compile and stitch the required hardware accelerators (kernels) into the platform and generate final SD Card image using Vitis Flow.</p>
<p>VVAS sources already has ready to build example Vitis workspace for <code class="docutils literal notranslate"><span class="pre">smart_model_select</span></code> Application. This workspace uses Vitis Flow that stitches kernels into the platform and generates final SD card image. Follow below mentioned steps to build the final image.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">examples</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">smart_model_select</span>
<span class="n">make</span> <span class="n">PLATFORM</span><span class="o">=&lt;</span><span class="n">PLATFORM_PATH</span><span class="o">&gt;</span> <span class="n">DPU_TRD_PATH</span><span class="o">=&lt;</span><span class="n">DPU_PATH</span><span class="o">&gt;</span> <span class="n">HW_ACCEL_PATH</span><span class="o">=&lt;</span><span class="n">IMAGE_PROCESSING_PATH</span><span class="o">&gt;</span>

<span class="n">PLATFORM_PATH</span><span class="o">=&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">platforms</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">zcu104_vcuDec_DP</span><span class="o">/</span><span class="n">platform_repo</span><span class="o">/</span><span class="n">xilinx_zcu104_vcuDec_DP_202220_1</span><span class="o">/</span><span class="n">export</span><span class="o">/</span><span class="n">xilinx_zcu104_vcuDec_DP_202220_1</span><span class="o">/</span><span class="n">xilinx_zcu104_vcuDec_DP_202220_1</span><span class="o">.</span><span class="n">xpfm</span>

<span class="n">DPU_PATH</span><span class="o">=&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">DPUCZDX8G_VAI_v3</span><span class="mf">.0</span>

<span class="n">IMAGE_PROCESSING_PATH</span><span class="o">=&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">accel</span><span class="o">-</span><span class="n">hw</span>
</pre></div>
</div>
<p>Once above build is done, final sdcard image is available at <code class="docutils literal notranslate"><span class="pre">./binary_container_1/sd_card.img</span></code> location.</p>
</div>
<div class="section" id="build-vvas-plug-ins-and-libraries">
<span id="build-vvas-plugins-and-libs"></span><h2>Build VVAS Plug-ins and Libraries<a class="headerlink" href="#build-vvas-plug-ins-and-libraries" title="Permalink to this headline">¶</a></h2>
<p>VVAS Plugins and libraries are part of petalinux bsp and are built along with building platform. So, no need to build again. Still if one wants to build these for some reason, follow the steps mentioned below,</p>
<div class="section" id="setting-sysroot">
<h3>Setting Sysroot<a class="headerlink" href="#setting-sysroot" title="Permalink to this headline">¶</a></h3>
<p>Sysroot is required to build the VVAS GStreamer plugins. Sysroot installer location depends on whether you are using pre-built binaries, or you have built the platform from scratch.</p>
<p>If you have downloaded the pre-built binaries in folder, say <code class="docutils literal notranslate"><span class="pre">PREBUILT_BINARIES</span></code>, then you can find the Sysroot installer at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PREBUILT_BINARIES</span><span class="o">&gt;/</span><span class="n">vvas_smart_model_select_2022</span><span class="mf">.2</span><span class="n">_zcu104</span><span class="o">/</span><span class="n">sdk</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>If you have built the platform yourself, then Sysroot installer is available at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">platforms</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">zcu104_vcuDec_DP</span><span class="o">/</span><span class="n">platform_repo</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">sw_components</span><span class="o">/</span><span class="n">sdk</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>One need to install the sysroot. Create a folder, say <strong>sysroot</strong> in <cite>VVAS_SOURCES</cite>. Command for sysroot generation is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">sdk</span><span class="o">.</span><span class="n">sh</span><span class="o">&gt;/</span><span class="n">sdk</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">y</span> <span class="o">-</span><span class="n">d</span> <span class="n">VVAS_SOURCES</span><span class="o">/</span><span class="n">sysroot</span><span class="o">/</span>
</pre></div>
</div>
<p>Now sysroot is installed. You are ready to build plugins and applications.</p>
</div>
<div class="section" id="build-plugins-and-libraries">
<h3>Build Plugins and Libraries<a class="headerlink" href="#build-plugins-and-libraries" title="Permalink to this headline">¶</a></h3>
<p>Get the VVAS Sources if not done already. Follow the steps mentioned below.</p>
<ul>
<li><p>Navigate to the folder, say <code class="docutils literal notranslate"><span class="pre">VVAS_SOURCES</span></code>, where you want to clone the VVAS source tree.</p></li>
<li><p>Clone VVAS repo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recurse</span><span class="o">-</span><span class="n">submodules</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Xilinx</span><span class="o">/</span><span class="n">VVAS</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>VVAS Source tree structure is described below:</p>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/vvas_source_tree_structure.png"><img alt="../../_images/vvas_source_tree_structure.png" src="../../_images/vvas_source_tree_structure.png" style="width: 300px;" /></a>
</div>
<ul class="simple">
<li><p><strong>vvas-utils:</strong> This folder contains the source code for the VVAS kernel interface to be exposed by the acceleration software libraries, abstraction APIs on top of the Xilinx Runtime (XRT) tool, and common headers (for example, metadata).</p></li>
<li><p><strong>vvas-core:</strong> This folder contains the source code of core APIs.</p></li>
<li><p><strong>vvas-gst-plugins:</strong> This folder contains all the VVAS GSteamer plug-ins, including the infrastructure plug-ins and the Custom plug-ins.</p></li>
<li><p><strong>vvas-accel-sw-libs:</strong> Contains source for the acceleration software libraries that are called from the GStreamer infrastructure plug-ins.</p></li>
<li><p><strong>vvas-accel-hw:</strong> This folder contains the hardware kernel source code.</p></li>
<li><p><strong>vvas-examples:</strong> This repository hosts example solutions.</p></li>
<li><p><strong>vvas-platforms:</strong> This folder contains the reference platforms for different applications.</p></li>
</ul>
</li>
<li><p>Navigate to <code class="docutils literal notranslate"><span class="pre">VVAS_SOURCES/VVAS</span></code> folder</p></li>
<li><p>Unset the LD library path environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unset</span> <span class="n">LD_LIBRARY_PATH</span>
</pre></div>
</div>
</li>
<li><p>Set the sysroot path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">VVAS_SOURCES</span><span class="o">/</span><span class="n">sysroot</span><span class="o">/</span><span class="n">environment</span><span class="o">-</span><span class="n">setup</span><span class="o">-</span><span class="n">cortexa72</span><span class="o">-</span><span class="n">cortexa53</span><span class="o">-</span><span class="n">xilinx</span><span class="o">-</span><span class="n">linux</span>
</pre></div>
</div>
<p>You must have write permission to the sysroot.</p>
</li>
<li><p>Build VVAS plugins and libraries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">build_install_vvas</span><span class="o">.</span><span class="n">sh</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">Edge</span>
</pre></div>
</div>
</li>
<li><p>When above step is complete, VVAS plugins are generated as <code class="docutils literal notranslate"><span class="pre">install/vvas_installer.tar.gz</span></code>.</p></li>
<li><p>Copy <code class="docutils literal notranslate"><span class="pre">install/vvas_installer.tar.gz</span></code> onto the root folder (/) of the target board and untar it. VVAS Plugins are now installed on the target device.</p></li>
</ul>
</div>
<div class="section" id="build-smart-model-select-application">
<h3>Build Smart Model Select Application<a class="headerlink" href="#build-smart-model-select-application" title="Permalink to this headline">¶</a></h3>
<p>The example application (smart_model_select) is available in the “vvas-example” section of VVAS repository. Follow below steps to compile the application:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">VVAS_SOURCES</span><span class="o">&gt;/</span><span class="n">VVAS</span><span class="o">/</span><span class="n">vvas</span><span class="o">-</span><span class="n">examples</span><span class="o">/</span><span class="n">Embedded</span><span class="o">/</span><span class="n">smart_model_select</span><span class="o">/</span><span class="n">src</span>
<span class="n">unset</span> <span class="n">LD_LIBRARY_PATH</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="n">sysroot</span> <span class="n">path</span><span class="o">&gt;/</span><span class="n">environment</span><span class="o">-</span><span class="n">setup</span><span class="o">-</span><span class="n">cortexa72</span><span class="o">-</span><span class="n">cortexa53</span><span class="o">-</span><span class="n">xilinx</span><span class="o">-</span><span class="n">linux</span>
<span class="n">make</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>On zcu104 boards, Cascaded pipelines OR several ML instances running simultaneously are sending board into bad state and needs reboot to recover from it. The default value of IOUT_OC_FAULT_LIMIT on PMIC chip irps5401 is too low and that is causing the temperature fault limit getting crossed. Workaround is to increase this limit. But there is risk of board getting damaged if running for long time.</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="platforms_and_applications.html" class="btn btn-neutral float-left" title="Platforms And Applications" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Tutorials/MultiChannelML.html" class="btn btn-neutral float-right" title="Multichannel ML" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on January 31, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>