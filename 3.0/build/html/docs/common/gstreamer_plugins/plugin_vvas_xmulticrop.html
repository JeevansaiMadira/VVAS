<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>vvas_xmulticrop &mdash; Vitis™ Video Analytics SDK 3.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="vvas_xcompositor" href="plugin_vvas_xcompositor.html" />
    <link rel="prev" title="vvas_xdefunnel" href="plugin_vvas_xdefunnel.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Vitis™ Video Analytics SDK
            <img src="../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Base Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="common_plugins.html">VVAS GStreamer Plugins</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="custom_plugins.html">Custom Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xmetaaffixer.html">vvas_xmetaaffixer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xabrscaler.html">vvas_xabrscaler</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xinfer.html">vvas_xinfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xoptflow.html">vvas_xoptflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xoverlay.html">vvas_xoverlay</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xtracker.html">vvas_xtracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xskipframe.html">vvas_xskipframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xreorderframe.html">vvas_xreorderframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xmetaconvert.html">vvas_xmetaconvert</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xfunnel.html">vvas_xfunnel</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xdefunnel.html">vvas_xdefunnel</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">vvas_xmulticrop</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#prerequisite">Prerequisite</a></li>
<li class="toctree-l4"><a class="reference internal" href="#input-and-output">Input and Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="#control-parameters-and-plug-in-properties">Control Parameters and Plug-in Properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-pipelines">Example Pipelines</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vvas-xmulticrop-with-software-scaling-kernel">vvas_xmulticrop with software scaling kernel</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xcompositor.html">vvas_xcompositor</a></li>
<li class="toctree-l3"><a class="reference internal" href="vvas_bufferpool_and_allocator.html">VVAS Bufferpool &amp; Allocator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="infra_plugins.html">Infrastructure Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../meta_data/vvas_meta_data_structures.html">VVAS Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../for_developers.html">VVAS For Advanced Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug_support.html">VVAS Debug Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/embedded-plugins.html">VVAS GStreamer Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Center</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../DC/platforms_and_applications.html">Platforms &amp; Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/2.0/build/html/index.html">2.0</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.1/build/html/index.html">1.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.0/build/html/index.html">1.0</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis™ Video Analytics SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="common_plugins.html">GStreamer Plug-ins</a> &raquo;</li>
          <li><a href="custom_plugins.html">Custom Plug-ins</a> &raquo;</li>
      <li>vvas_xmulticrop</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/common/gstreamer_plugins/plugin_vvas_xmulticrop.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="vvas-xmulticrop">
<span id="id1"></span><h1>vvas_xmulticrop<a class="headerlink" href="#vvas-xmulticrop" title="Permalink to this headline">¶</a></h1>
<p>In ML applications we often need to crop the video frame for processing objects and number of objects per frame may differ. For ML we may also need preprocessing.</p>
<p><cite>vvas_xmulticrop</cite> is a GStreamer plug-in to do scaling, color space conversion, preprocessing and to crop single or multiple objects.
It takes one input frame and can crop one or more objects from it. Scaling, color space conversion and preprocessing can be applied to all the cropped objects/buffers.
If user wants to get cropped buffer directly on the source pad, they can use static cropping, but with static cropping user can crop only one object.
If user wants to crop more than one objects, they can use dynamic cropping, dynamically cropped objects/buffers are not sent onto the source pad, they are attached as metadata into the output buffer.
Both static and dynamic cropping can be performed simultaneously.</p>
<p>For more implementation details, refer to <a class="reference external" href="https://github.com/Xilinx/VVAS/tree/master/vvas-gst-plugins/sys/multicrop">vvas_xmulticrop source code</a>.</p>
<p>This plug-in supports:</p>
<ul class="simple">
<li><p>Single sink pad, single source pad</p></li>
<li><p>Color space conversion</p></li>
<li><p>Resize</p></li>
<li><p>Pre-processing</p></li>
<li><p>Static and Dynamic cropping</p></li>
</ul>
<p>vvas_xmulticrop plug-in is similar to <code class="docutils literal notranslate"><span class="pre">vvas_xabrscaler</span></code> excepts below features:</p>
<ul class="simple">
<li><p>It has only one source pad</p></li>
<li><p>It supports dynamic cropping.</p></li>
</ul>
<p>Static Cropping: For cropping only one object. The cropped object/buffer is sent to the source pad. <cite>s-crop-x</cite>, <cite>s-crop-y</cite>, <cite>s-crop-width</cite>, <cite>s-crop-height</cite> are the properties to set the crop parameters.</p>
<p>Dynamic Cropping: For cropping more than one objects from the input buffer. To use dynamic crop feature user must send crop coordinates attached to the buffer in GstVideoRegionOfInterestMeta metadata and GstVideoRegionOfInterestMeta-&gt;roi_type must be set to “roi-crop-meta”. One instance of GstVideoRegionOfInterestMeta in buffer represents one object for dynamic crop. <cite>vvas_xmulticrop</cite> will dynamically crop the object and attach the cropped objects/buffers to output buffer in GstVideoRegionOfInterestMeta-&gt;params. GstVideoRegionOfInterestMeta-&gt;params is a GList * of GstStructure. Dynamically cropped buffer is attached into this field, The name of GstStructure is “roi-buffer”, and this GstStructure has only one field “sub-buffer” of type GST_TYPE_BUFFER. User should extract this cropped buffer use it and unref it.
User can choose to resize these cropped buffers to some width and height by setting <cite>d-height</cite> and <cite>d-width</cite> properties. If these properties are not set, then cropped buffers will not be resized.</p>
<p>If user wants cropped buffers to be of different format than the input format, they can specify this by setting <cite>d-format</cite> gstreamer property. If this property is not set all cropped buffers will have format same as input buffer.</p>
<p>User specified pre-processing is applied to dynamically cropped buffers only, if user wants it to be applied on output buffer/static crop buffers also, they can set <cite>ppe-on-main buffer</cite> gstreamer property.</p>
<p>Static and dynamic cropping both is possible simultaneously. As explained statically cropped buffer is sent on the source pad and dynamically cropped buffers are attached into that output buffer.</p>
<p><cite>vvas_xmulticrop</cite> supports at max 39 dynamic crops.
Memory for dynamically cropped buffers is allocated from a GStreamer buffer pool, there is no upper limit on this buffer pool. So, if buffers are not freed, new buffers will be allocated which may lead to more memory consumption.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <cite>vvas_xmulticrop</cite> plug-in controls the image-processing kernel. If your application uses this plug-in, then make sure that image-processing kernel is included in your hardware design.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure that the image-processing hardware kernel supports maximum resolution required by your application.</p>
</div>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<p><cite>vvas_xmulticrop</cite> plug-in is dependent on the <code class="docutils literal notranslate"><span class="pre">image-processing</span></code> kernel. If your application uses this plug-in, then make sure that <code class="docutils literal notranslate"><span class="pre">image-processing</span></code> kernel is included in your hardware design. Also make sure that the <code class="docutils literal notranslate"><span class="pre">image-processing</span></code> hardware kernel supports maximum resolution and required color formats by your application.</p>
<p>Maximum resolution and various color formats supported by <code class="docutils literal notranslate"><span class="pre">image-processing</span></code> kernel can be found in <a class="reference external" href="https://github.com/Xilinx/VVAS/blob/master/vvas-accel-hw/image_processing/image_processing_config.h">image-processing kernel config</a></p>
</div>
<div class="section" id="input-and-output">
<h2>Input and Output<a class="headerlink" href="#input-and-output" title="Permalink to this headline">¶</a></h2>
<p>This plug-in accepts buffers with the following color format standards:</p>
<ul class="simple">
<li><p>RGBx</p></li>
<li><p>YUY2</p></li>
<li><p>r210</p></li>
<li><p>Y410</p></li>
<li><p>NV16</p></li>
<li><p>NV12</p></li>
<li><p>RGB</p></li>
<li><p>v308</p></li>
<li><p>I422_10LE</p></li>
<li><p>GRAY8</p></li>
<li><p>NV12_10LE32</p></li>
<li><p>BGRx</p></li>
<li><p>GRAY10_LE32</p></li>
<li><p>BGRx</p></li>
<li><p>UYVY</p></li>
<li><p>BGR</p></li>
<li><p>RGBA</p></li>
<li><p>BGRA</p></li>
<li><p>I420</p></li>
<li><p>GBR</p></li>
</ul>
</div>
<div class="section" id="control-parameters-and-plug-in-properties">
<h2>Control Parameters and Plug-in Properties<a class="headerlink" href="#control-parameters-and-plug-in-properties" title="Permalink to this headline">¶</a></h2>
<p>The following table lists the GStreamer plug-in properties supported by the vvas_xmulticrop plug-in.</p>
<p>Table 13: vvas_xmulticrop Plug-in Properties</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 15%" />
<col style="width: 16%" />
<col style="width: 26%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property Name</strong></p></th>
<th class="head"><p><strong>Type</strong></p></th>
<th class="head"><p><strong>Range</strong></p></th>
<th class="head"><p><strong>Default</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>avoid-output-copy</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>False</p></td>
<td><p>Avoid output
frames copy even
when downstream
does not support
GstVideoMeta
metadata</p></td>
</tr>
<tr class="row-odd"><td><p>enable-pipeline</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>false</p></td>
<td><p>Enable buffer
pipelining to
improve
performance in
non zero-copy
use cases</p></td>
</tr>
<tr class="row-even"><td><p>in-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS input memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-odd"><td><p>out-mem-bank</p></td>
<td><p>Unsigned int</p></td>
<td><p>0 - 65535</p></td>
<td><p>0</p></td>
<td><p>VVAS o/p memory
bank to allocate
memory</p></td>
</tr>
<tr class="row-even"><td><p>xclbin-location</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>NULL</p></td>
<td><p>The
location of
xclbin.</p></td>
</tr>
<tr class="row-odd"><td><p>kernel-name</p></td>
<td><p>string</p></td>
<td><p>N/A</p></td>
<td><p>image_processing:
{image_processing_1}</p></td>
<td><p>Kernel name
and
instance
separated
by a colon.</p></td>
</tr>
<tr class="row-even"><td><p>dev-idx</p></td>
<td><p>integer</p></td>
<td><p>0 to 31</p></td>
<td><p>-1</p></td>
<td><p>Device index
This is valid
only in PCIe/
Data Center
platforms.</p></td>
</tr>
<tr class="row-odd"><td><p>ppc</p></td>
<td><p>integer</p></td>
<td><p>1, 2, 4</p></td>
<td><p>2</p></td>
<td><p>Pixel per
clock
supported
by a image-
processing
kernel. Default
value 2 for Edge,
4 for PCIe
platform.</p></td>
</tr>
<tr class="row-even"><td><p>scale-mode</p></td>
<td><p>integer</p></td>
<td><p>0, 1, 2</p></td>
<td><p>0</p></td>
<td><p>Scale algorithm
to use:
0:BILINEAR
1:BICUBIC
2:POLYPHASE
Default value
0 for Edge,
2 for PCIe
platform.</p></td>
</tr>
<tr class="row-odd"><td><p>coef-load-type</p></td>
<td><p>integer</p></td>
<td><p>0 =&gt; Fixed
1 =&gt; Auto</p></td>
<td><p>0</p></td>
<td><p>Type of filter
Coefficients to
be used: Fixed
or Auto
generated.
Default value
0 for Edge,
1 for PCIe
platform.</p></td>
</tr>
<tr class="row-even"><td><p>num-taps</p></td>
<td><p>integer</p></td>
<td><p>6=&gt;6 taps
8=&gt;8 taps
10=&gt;10 taps
12=&gt;12 taps</p></td>
<td><p>6</p></td>
<td><p>Number of filter
taps to be used
for scaling.
Default value
6 for Edge,
12 for PCIe
platform.</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-b</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for blue channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-even"><td><p>alpha-g</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for green channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-odd"><td><p>alpha-r</p></td>
<td><p>float</p></td>
<td><p>0 to 128</p></td>
<td><p>0</p></td>
<td><p>Mean subtraction
for red  channel
, needed only if
PPE is required</p></td>
</tr>
<tr class="row-even"><td><p>beta-b</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>Scaling for blue
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-odd"><td><p>beta-g</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for green
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-even"><td><p>beta-r</p></td>
<td><p>float</p></td>
<td><p>0 to 1</p></td>
<td><p>1</p></td>
<td><p>scaling for red
channel, needed
only if PPE is
required</p></td>
</tr>
<tr class="row-odd"><td><p>s-crop-x</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop X coordinate
for static
cropping</p></td>
</tr>
<tr class="row-even"><td><p>s-crop-y</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop Y coordinate
for static
cropping</p></td>
</tr>
<tr class="row-odd"><td><p>s-crop-width</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop width for
static cropping
(minimum: 16),
when this is 0
or not set, it
will be
calculated as
input width -
<cite>s-crop-x</cite></p></td>
</tr>
<tr class="row-even"><td><p>s-crop-height</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Crop height for
static cropping
(minimum: 16),
when this is 0
or not set, it
will be
calculated as
input height -
<cite>s-crop-y</cite></p></td>
</tr>
<tr class="row-odd"><td><p>d-width</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Width of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-even"><td><p>d-height</p></td>
<td><p>unsigned int</p></td>
<td><p>0 to
4294967925</p></td>
<td><p>0</p></td>
<td><p>Height of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-odd"><td><p>d-format</p></td>
<td><p>integer</p></td>
<td><p>0,2,4,5,7,8,
11,12,15,16,
23,25,41,45,
48,51,78,79,
83</p></td>
<td><p>0</p></td>
<td><p>Format of
dynamically
cropped buffers</p></td>
</tr>
<tr class="row-even"><td><p>ppe-on-main-buffer</p></td>
<td><p>boolean</p></td>
<td><p>true/false</p></td>
<td><p>0</p></td>
<td><p>Apply pre-
processing on
main buffer also</p></td>
</tr>
<tr class="row-odd"><td><p>software-scaling</p></td>
<td><p>Boolean</p></td>
<td><p>true/false</p></td>
<td><p>false</p></td>
<td><p>Enable software
scaling instead
of accelerated
scaling.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Image-processing IP has some alignment requirement, hence user given parameters for crop are aligned as per the IP requirement, alignment ensures that it covers the region of crop specified by user, hence final cropped image may have extra pixels cropped. Crop width and height must be at least 16.</p>
</div>
</div>
<div class="section" id="example-pipelines">
<h2>Example Pipelines<a class="headerlink" href="#example-pipelines" title="Permalink to this headline">¶</a></h2>
<p>The pipeline mentioned below is for PCIe/Data Center platform. In case you want to execute this pipeline on Embedded platform, then remove <strong>dev-idx</strong> property in the pipelines mentioned below.</p>
<ul class="simple">
<li><p>Below pipeline converts NV12 to RGB and performs scaling from 1920x1080 to 640x480. The pipeline mentioned below is for PCIe/Data Center platform.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 xclbin-location=&lt;xclbin path&gt; \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below pipeline performs pre-processing along with color space conversion and scaling on output buffers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 ppe-on-main-buffer=true alpha-r=124 alpha-g=116 alpha-b=104 beta-r=0.547 beta-g=0.56 beta-b=0.557 xclbin-location=&lt;xclbin path&gt; \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below pipeline performs static cropping at (x,y) = (100,80) and (width,height)= (1280,720), this cropped buffers gets scaled to 640x480 and converted to RGB.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop dev-idx=0 s-crop-x=100 s-crop-y=80 s-crop-width=1280 s-crop-height=720 xclbin-location=&lt;xclbin path&gt; \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to add GstVideoRegionOfInterestMeta for dynamic cropping.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstVideoRegionOfInterestMeta</span> <span class="o">*</span><span class="n">meta</span><span class="p">;</span>
<span class="n">meta</span> <span class="o">=</span> <span class="n">gst_buffer_add_video_region_of_interest_meta</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s2">&quot;roi-crop-meta&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">meta</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">p_id</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span>  <span class="n">x</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span>  <span class="n">y</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
  <span class="n">meta</span><span class="o">-&gt;</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;meta: x:</span><span class="si">%u</span><span class="s2"> y:</span><span class="si">%u</span><span class="s2">, w:</span><span class="si">%u</span><span class="s2"> h:</span><span class="si">%u</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">x</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">y</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">w</span><span class="p">,</span> <span class="n">meta</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to read GstVideoRegionOfInterestMeta and how to extract dynamically cropped buffer/object</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">read_crop_meta</span> <span class="p">(</span><span class="n">GstBuffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">gpointer</span> <span class="n">state</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
  <span class="n">GstMeta</span> <span class="o">*</span><span class="n">_meta</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">((</span><span class="n">_meta</span> <span class="o">=</span> <span class="n">gst_buffer_iterate_meta_filtered</span> <span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state</span><span class="p">,</span>
              <span class="n">GST_VIDEO_REGION_OF_INTEREST_META_API_TYPE</span><span class="p">)))</span> <span class="p">{</span>
    <span class="n">GstStructure</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
    <span class="n">GstVideoRegionOfInterestMeta</span> <span class="o">*</span><span class="n">roi_meta</span> <span class="o">=</span>
                          <span class="p">(</span><span class="n">GstVideoRegionOfInterestMeta</span>  <span class="o">*</span><span class="p">)</span> <span class="n">_meta</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_strcmp0</span><span class="p">(</span><span class="s2">&quot;roi-crop-meta&quot;</span><span class="p">,</span> <span class="n">g_quark_to_string</span> <span class="p">(</span><span class="n">roi_meta</span><span class="o">-&gt;</span><span class="n">roi_type</span><span class="p">)))</span> <span class="p">{</span>
      <span class="o">//</span><span class="n">This</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">the</span> <span class="n">metadata</span> <span class="n">we</span> <span class="n">are</span> <span class="n">looking</span> <span class="k">for</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">//</span><span class="n">Got</span> <span class="n">the</span> <span class="n">ROI</span> <span class="n">crop</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">prepare</span> <span class="n">output</span> <span class="n">buffer</span>
    <span class="o">//</span><span class="n">Extract</span> <span class="n">dynamically</span> <span class="n">cropped</span> <span class="n">buffer</span> <span class="kn">from</span> <span class="nn">this</span> <span class="n">meta</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">gst_video_region_of_interest_meta_get_param</span> <span class="p">(</span><span class="n">roi_meta</span><span class="p">,</span> <span class="s2">&quot;roi-buffer&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">GstBuffer</span> <span class="o">*</span><span class="n">sub_buffer</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">;</span>
      <span class="n">gst_structure_get</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;sub-buffer&quot;</span><span class="p">,</span> <span class="n">GST_TYPE_BUFFER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sub_buffer</span><span class="p">,</span> <span class="n">NULL</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sub_buffer</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">//</span><span class="n">use</span> <span class="n">sub_buffer</span> <span class="ow">and</span> <span class="n">unref</span> <span class="n">it</span>
        <span class="n">dump_dynamically_cropped_buffer</span> <span class="p">(</span><span class="n">sub_buffer</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;couldn&#39;t get sub buffer&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;couldn&#39;t get expected struct&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Below code shows how to read/dump dynamically cropped buffers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dump_dynamically_cropped_buffer (GstBuffer *sub_buffer) {
  /* Read GstVideoMeta from the buffer, dump the buffer to file */
  GstVideoMeta *vmeta = NULL;
  FILE *fp;
  GstMapInfo map = {0};
  gchar name[256] = {0};
  GstBuffer *new_outbuf;
  GstVideoFrame new_frame = { 0 }, out_frame = { 0 };
  GstVideoInfo *vinfo;

  if (!sub_buffer) {
    return FALSE;
  }

  vmeta = gst_buffer_get_video_meta (sub_buffer);
  if (!vmeta) {
    printf&quot;couldn&#39;t get video meta&quot;);
  }

  sprintf (name, &quot;dynbuf_%ux%u_%s.yuv&quot;, vmeta-&gt;width, vmeta-&gt;height,
                        gst_video_format_to_string (vmeta-&gt;format));
  fp = fopen (name, &quot;wb&quot;);
  if (!fp) {
    return FALSE;
  }

  vinfo = gst_video_info_new ();
  gst_video_info_set_format (vinfo, vmeta-&gt;format, vmeta-&gt;width, vmeta-&gt;height);

  new_outbuf = gst_buffer_new_and_alloc (GST_VIDEO_INFO_SIZE (vinfo));
  if (!new_outbuf) {
    printf(&quot;couldn&#39;t allocate buffer&quot;);
    gst_video_info_free (vinfo);
    fclose (fp);
    return FALSE;
  }

  gst_video_frame_map (&amp;out_frame, vinfo, sub_buffer, GST_MAP_READ);
  gst_video_frame_map (&amp;new_frame, vinfo, new_outbuf, GST_MAP_WRITE);
  gst_video_frame_copy (&amp;new_frame, &amp;out_frame);
  gst_video_frame_unmap (&amp;out_frame);
  gst_video_frame_unmap (&amp;new_frame);
  gst_video_info_free (vinfo);

  if (gst_buffer_map ( new_outbuf, &amp;map, GST_MAP_READ)) {
    fwrite (map.data, map.size, 1, fp);
  }
  gst_buffer_unmap (new_outbuf, &amp;map);
  gst_buffer_unref (new_outbuf);
  fclose (fp);
  gst_buffer_unref (sub_buffer);
  return TRUE;
}
</pre></div>
</div>
</div>
<div class="section" id="vvas-xmulticrop-with-software-scaling-kernel">
<h2>vvas_xmulticrop with software scaling kernel<a class="headerlink" href="#vvas-xmulticrop-with-software-scaling-kernel" title="Permalink to this headline">¶</a></h2>
<p>VVAS plugin “vvas_xmulticrop” can also work with software implementation of the IP. User has to set “software-scaling” property to “true”, set the “kernel-name” to “image_processing_sw:{image_processing_sw}”,
also set “coef-load-type” to “fixed” type and set “num-taps” to 12. Below are the formats supported by the current implementation.</p>
<ul class="simple">
<li><p>NV12</p></li>
<li><p>RGB</p></li>
<li><p>GRAY8</p></li>
<li><p>BGR</p></li>
<li><p>I420</p></li>
</ul>
<p>Note: For GRAY8, only scaling is supported, cross format conversion is not supported.</p>
<div class="section" id="example-pipeline">
<h3>Example pipeline:<a class="headerlink" href="#example-pipeline" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 -v \
videotestsrc num-buffers=10 ! video/x-raw,format=NV12,width=1920,height=1080 \
! vvas_xmulticrop kernel-name=&quot;image_processing_sw:{image_processing_sw_1}&quot; software-scaling=true coef-load-type=0 num-taps=12 \
! video/x-raw,format=RGB,width=640,height=480 ! filesink location=out.yuv
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plugin_vvas_xdefunnel.html" class="btn btn-neutral float-left" title="vvas_xdefunnel" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plugin_vvas_xcompositor.html" class="btn btn-neutral float-right" title="vvas_xcompositor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on January 31, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>