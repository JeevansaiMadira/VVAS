<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>VVAS Buffer pool and Allocator &mdash; Vitis™ Video Analytics SDK 3.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Infrastructure Plug-ins and Acceleration Software Libraries" href="infra_plugins.html" />
    <link rel="prev" title="vvas_xcompositor" href="plugin_vvas_xcompositor.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Vitis™ Video Analytics SDK
            <img src="../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Base Infrastructure</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="common_plugins.html">VVAS GStreamer Plugins</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="custom_plugins.html">Custom Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xmetaaffixer.html">vvas_xmetaaffixer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xabrscaler.html">vvas_xabrscaler</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xinfer.html">vvas_xinfer</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xoptflow.html">vvas_xoptflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xoverlay.html">vvas_xoverlay</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xtracker.html">vvas_xtracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xskipframe.html">vvas_xskipframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xreorderframe.html">vvas_xreorderframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xmetaconvert.html">vvas_xmetaconvert</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xfunnel.html">vvas_xfunnel</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xdefunnel.html">vvas_xdefunnel</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xmulticrop.html">vvas_xmulticrop</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_vvas_xcompositor.html">vvas_xcompositor</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">VVAS Bufferpool &amp; Allocator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gstvvasbufferpool">GstVvasBufferPool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gstvvasallocator">GstVvasAllocator</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="infra_plugins.html">Infrastructure Plugins</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../meta_data/vvas_meta_data_structures.html">VVAS Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../for_developers.html">VVAS For Advanced Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug_support.html">VVAS Debug Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/embedded-plugins.html">VVAS GStreamer Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Center</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../DC/platforms_and_applications.html">Platforms &amp; Applications</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis™ Video Analytics SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="common_plugins.html">GStreamer Plug-ins</a> &raquo;</li>
          <li><a href="custom_plugins.html">Custom Plug-ins</a> &raquo;</li>
      <li>VVAS Buffer pool and Allocator</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/common/gstreamer_plugins/vvas_bufferpool_and_allocator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="vvas-buffer-pool-and-allocator">
<h1>VVAS Buffer pool and Allocator<a class="headerlink" href="#vvas-buffer-pool-and-allocator" title="Permalink to this headline">¶</a></h1>
<p>Buffer pool and buffer allocator are core elements of GStreamer framework. VVAS is based on Xilinx Run Time (XRT) framework to manage multi device solutions. For physically contiguous memory requirements, VVAS user XRT buffer allocator. To abstract the XRT related complexities, VVAS has developped GstVvasBufferPool and GstVvasAllocator plug-ins which are derived form the GStreamer base classes.</p>
<div class="section" id="gstvvasbufferpool">
<h2>GstVvasBufferPool<a class="headerlink" href="#gstvvasbufferpool" title="Permalink to this headline">¶</a></h2>
<p>The GStreamer VVAS buffer pool holds the pool of video frames allocated using the GStreamer allocator object. It is derived from the GStreamer base video buffer pool object (GstVideoBufferPool).</p>
<p>The VVAS buffer pool:</p>
<ul class="simple">
<li><p>Allocates buffers with stride and height alignment requirements. (e.g., the video codec unit (VCU) requires the stride to be aligned with 256 bytes and the height aligned with 64 bytes)</p></li>
<li><p>Provides a callback to the GStreamer plug-in when the buffer comes back to the pool after it is used.</p></li>
</ul>
<p>The following API is used to create the buffer pool.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstBufferPool</span> <span class="o">*</span> <span class="n">gst_vvas_buffer_pool_new</span> <span class="p">(</span><span class="n">guint</span> <span class="n">stride_align</span><span class="p">,</span> <span class="n">guint</span> <span class="n">elevation_align</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
        <span class="n">stride_align</span> <span class="o">-</span> <span class="n">stride</span> <span class="n">alignment</span> <span class="n">required</span>
        <span class="n">elevation_align</span> <span class="o">-</span> <span class="n">height</span> <span class="n">alignment</span> <span class="n">required</span>

<span class="n">Return</span><span class="p">:</span>
        <span class="n">GstBufferPool</span> <span class="nb">object</span> <span class="n">handle</span>
</pre></div>
</div>
<p>Plug-ins can use the following API to set the callback function on the VVAS buffer pool and the callback function is called when the buffer arrives back to the pool after it is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Buffer</span> <span class="n">release</span> <span class="n">callback</span> <span class="n">function</span> <span class="n">pointer</span> <span class="n">declaration</span><span class="p">:</span>
<span class="n">typedef</span> <span class="n">void</span> <span class="p">(</span><span class="o">*</span> <span class="n">ReleaseBufferCallback</span><span class="p">)(</span><span class="n">GstBuffer</span> <span class="o">*</span> <span class="n">buf</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>

<span class="n">void</span> <span class="n">gst_vvas_buffer_pool_set_release_buffer_cb</span> <span class="p">(</span><span class="n">GstVvasBufferPool</span> <span class="o">*</span> <span class="n">xpool</span><span class="p">,</span>
<span class="n">ReleaseBufferCallback</span> <span class="n">release_buf_cb</span><span class="p">,</span> <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">xpool</span> <span class="o">-</span> <span class="n">VVAS</span> <span class="n">buffer</span> <span class="n">pool</span> <span class="n">created</span> <span class="n">using</span> <span class="n">gst_vvas_buffer_pool_new</span>
   <span class="n">release_buf_cb</span> <span class="o">-</span> <span class="n">function</span> <span class="n">pointer</span> <span class="n">of</span> <span class="n">callback</span>
   <span class="n">user_data</span> <span class="o">-</span> <span class="n">user</span> <span class="n">provided</span> <span class="n">handle</span> <span class="n">to</span> <span class="n">be</span> <span class="n">sent</span> <span class="k">as</span> <span class="n">function</span> <span class="n">argument</span> <span class="k">while</span>
<span class="n">calling</span> <span class="n">release_buf_cb</span><span class="p">()</span>

<span class="n">Return</span><span class="p">:</span>
    <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="gstvvasallocator">
<h2>GstVvasAllocator<a class="headerlink" href="#gstvvasallocator" title="Permalink to this headline">¶</a></h2>
<p>The GStreamer VVAS allocator object is derived from an open source GstAllocator object designed for allocating memory using XRT APIs. The VVAS allocator is the backbone to the VVAS framework achieving zero-copy (wherever possible).</p>
<div class="section" id="allocator-apis">
<h3>Allocator APIs<a class="headerlink" href="#allocator-apis" title="Permalink to this headline">¶</a></h3>
<p>GStreamer plug-in developers can use the following APIs to interact with the VVAS allocator. To allocate memory using XRT, the GStreamer plug-ins and buffer pools require the GstAllocator object provided by the following API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GstAllocator</span><span class="o">*</span> <span class="n">gst_vvas_allocator_new</span> <span class="p">(</span><span class="n">guint</span> <span class="n">dev_idx</span><span class="p">,</span> <span class="n">gboolean</span> <span class="n">need_dma</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">dev_idx</span> <span class="o">-</span> <span class="n">FPGA</span> <span class="n">Device</span> <span class="n">index</span> <span class="n">on</span> <span class="n">which</span> <span class="n">memory</span> <span class="ow">is</span> <span class="n">going</span> <span class="n">to</span> <span class="n">allocated</span>
   <span class="n">need_dma</span> <span class="o">-</span> <span class="n">will</span> <span class="n">decide</span> <span class="n">memory</span> <span class="n">allocated</span> <span class="ow">is</span> <span class="n">dmabuf</span> <span class="ow">or</span> <span class="ow">not</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">GstAllocator</span> <span class="n">handle</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="n">NULL</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In PCIe platforms, the DMA buffer allocation support is not available. This means that the need_dma argument to gst_vvas_allocator_new() API must be false.</p>
</div>
<p>Use the following API to check if a particular GstMemory object is allocated using GstVvasAlloctor.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gboolean</span> <span class="n">gst_is_vvas_memory</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span> <span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">be</span> <span class="n">validated</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">true</span> <span class="k">if</span> <span class="n">memory</span> <span class="ow">is</span> <span class="n">allocated</span> <span class="n">using</span> <span class="n">VVAS</span> <span class="n">Allocator</span> <span class="ow">or</span> <span class="n">false</span>
</pre></div>
</div>
<p>When GStreamer plug-ins are interacting with hard-kernel/IP or soft-kernel, the plug-ins need physical memory addresses on an FPGA using the following API.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guint64</span> <span class="n">gst_vvas_allocator_get_paddr</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span> <span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">get</span> <span class="n">physical</span> <span class="n">address</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">valid</span> <span class="n">physical</span> <span class="n">address</span> <span class="n">on</span> <span class="n">FPGA</span> <span class="n">device</span> <span class="ow">or</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">failure</span>

<span class="n">Use</span> <span class="n">the</span> <span class="n">following</span> <span class="n">API</span> <span class="n">when</span> <span class="n">plug</span><span class="o">-</span><span class="n">ins</span> <span class="n">need</span> <span class="n">an</span> <span class="n">XRT</span> <span class="n">buffer</span> <span class="nb">object</span> <span class="p">(</span><span class="n">BO</span><span class="p">)</span> <span class="n">corresponding</span> <span class="n">to</span> <span class="n">an</span> <span class="n">VVAS</span> <span class="n">memory</span> <span class="nb">object</span><span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">guint</span> <span class="n">gst_vvas_allocator_get_bo</span> <span class="p">(</span><span class="n">GstMemory</span> <span class="o">*</span> <span class="n">mem</span><span class="p">)</span>

<span class="n">Parameters</span><span class="p">:</span>
   <span class="n">mem</span> <span class="o">-</span> <span class="n">memory</span> <span class="n">to</span> <span class="n">get</span> <span class="n">XRT</span> <span class="n">BO</span>

<span class="n">Return</span><span class="p">:</span>
   <span class="n">valid</span> <span class="n">XRT</span> <span class="n">BO</span> <span class="n">on</span> <span class="n">success</span> <span class="ow">or</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">failure</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="plugin_vvas_xcompositor.html" class="btn btn-neutral float-left" title="vvas_xcompositor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="infra_plugins.html" class="btn btn-neutral float-right" title="Infrastructure Plug-ins and Acceleration Software Libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2023, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on January 31, 2023.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>