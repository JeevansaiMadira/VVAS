<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->

<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="03af8d57-0a04-47a6-8f10-322fa00d8fc7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
<!-- Google Tag Manager -->
<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
<!-- End Google Tag Manager -->
  <title>Multi-instance High density Transcoding &mdash; Vitis™ Video Analytics SDK 2.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="GStreamer ABR Ladder Application" href="xabrladder.html" />
    <link rel="prev" title="Basic Transcoding pipelines" href="transcoding.html" /> 
</head>

<body class="wy-body-for-nav">

<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
<!-- End Google Tag Manager --> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
            <a href="../../../index.html" class="icon icon-home"> Vitis™ Video Analytics SDK
            <img src="../../../_static/xilinx-header-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Base Infrastructure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../common/common_plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../common/vvas_meta_data_structures.html">Meta Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../common/for_developers.html">For Advanced Developers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Embedded</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/embedded-plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Embedded/Tutorials/Tutorials.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Data Center</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../platforms_and_applications.html">Platforms &amp; Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DC_plugins.html">Plugins</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="transcoding.html">Basic Transcoding</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Multi-instance Transcoding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pre-requisite">Pre-requisite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-management">Resource Management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#jobslotreservation">jobSlotReservation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#launcher">Launcher</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="xabrladder.html">ABR Ladder Application</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../freq_asked_questions.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.1/build/html/index.html">1.1</a></li>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/VVAS/1.0/build/html/index.html">1.0</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: black" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Vitis™ Video Analytics SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="Tutorials.html">Tutorials for PCIe/Data Center platforms</a> &raquo;</li>
      <li>Multi-instance High density Transcoding</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/DC/Tutorials/multi_instance_launch_utilities.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="multi-instance-high-density-transcoding">
<h1>Multi-instance High density Transcoding<a class="headerlink" href="#multi-instance-high-density-transcoding" title="Permalink to this heading">¶</a></h1>
<p>Each <code class="docutils literal notranslate"><span class="pre">Zynq</span> <span class="pre">UltraScale+</span> <span class="pre">MPSoc</span></code> device has a decoder and an encoder with max capacity of encoding/decoding &#64;4Kp60. So, there can be more number of decoder/encoder instances running simultaneously in case the the total required capacity is less than 4Kp60. For example, we can launch 4x transcode pipelines of capacity 1080p60 resolution.</p>
<p>There are two <code class="docutils literal notranslate"><span class="pre">Zynq</span> <span class="pre">UltraScale+</span> <span class="pre">MPSoC</span></code> devices inside <code class="docutils literal notranslate"><span class="pre">Alveo</span> <span class="pre">U30</span></code> card and each is capable of transcoding &#64;4Kp60. If there are more such cards connected to the server, then this capacity is increased, and we can launch more transcode pipelines in parallel.</p>
<div class="section" id="pre-requisite">
<h2>Pre-requisite<a class="headerlink" href="#pre-requisite" title="Permalink to this heading">¶</a></h2>
<p>Before start executing the Transcoding use cases, make sure the setup is ready:</p>
<blockquote>
<div><ul class="simple">
<li><p>Required Alveo U30 cards are installed in the PCIe slots of the server machine.</p></li>
<li><p>VVAS 2.0 Package has been installed and the Alveo U30 cards are flashed with the required image. If not, follow the section <a class="reference internal" href="../u30_platform/u30_setup.html"><span class="doc">Alveo U30 setup for VVAS 2.0</span></a></p></li>
</ul>
</div></blockquote>
<p>If your setup is re-booted, or you have opened a fresh terminal, perform the following steps.</p>
<blockquote>
<div><div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="resource-management">
<h2>Resource Management<a class="headerlink" href="#resource-management" title="Permalink to this heading">¶</a></h2>
<p>When there are several devices/cards, connected to the server, then it is important to select correct device to launch each new instance of the transcode pipeline. Selection of device depends on how much capacity is left on that device and how much load new instance needs. This has been simplified by <code class="docutils literal notranslate"><span class="pre">XRM</span></code> (Xilinc Resource Manager). User need not know details about how XRM works. XRM keeps on checking the available capacity on each device and launches the transcode pipeline on a device only when it has capacity. If current device does not have the required capacity, then it goes to next device and launch the new pipeline instance if it has the capacity. User need not know details about how XRM works. There are two applications provided that will interact with XRM and manage the resource allocation.</p>
<p>Following XRM based applications are provided with varied ease-of-use to support the same:</p>
<ol class="arabic simple">
<li><p>jobSlotReservation</p></li>
<li><p>launcher</p></li>
</ol>
<div class="section" id="jobslotreservation">
<h3>jobSlotReservation<a class="headerlink" href="#jobslotreservation" title="Permalink to this heading">¶</a></h3>
<p>Each pipeline, be it simple decode, or simple transcode or and ABR ladder, is a JOB for jobSlotReservation application. Each compute unit and its load capacity in such pipeline is described in a json file and this json file is known as job descriptor. Sample job description files are located at : /opt/xilinx/launcher/scripts/describe_job</p>
<p>Based on the input resolution and type of use-case, the load requirement of compute units (CUs) within a JOB varies which in turn determines how many instances of each JOB can be launched on the available devices at a time.</p>
<p>Steps to use:</p>
<ol class="arabic simple">
<li><p>Once the device and host boot up, setup the environment:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>run the command :</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jobSlotReservation  &lt;job description file name&gt;
Ex: jobSlotReservation /opt/xilinx/launcher/scripts/describe_job/describe_job_h264_transcodeOnly_1080p60.json
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jobSlotReservation /opt/xilinx/launcher/scripts/describe_job/describe_job_h264_transcodeOnly_1080p60.json
<span class="o">[</span><span class="m">0</span><span class="o">]</span>: decoder plugin <span class="k">function</span> <span class="o">=</span><span class="m">0</span> success to run the <span class="k">function</span>, output_load:250000
<span class="o">[</span><span class="m">0</span><span class="o">]</span>: scaler plugin <span class="k">function</span> <span class="o">=</span><span class="m">0</span> success to run the <span class="k">function</span>, output_load:0
<span class="o">[</span><span class="m">0</span><span class="o">]</span>: encoder plugin <span class="k">function</span> <span class="o">=</span><span class="m">0</span> success to run the <span class="k">function</span>, output_load:250000 <span class="nv">enc_num</span><span class="o">=</span><span class="m">1</span> <span class="nv">la_load</span><span class="o">=</span><span class="m">250000</span>


For /opt/xilinx/launcher/scripts/describe_job/describe_job_h264_transcodeOnly_1080p60.json, Possible number of job slots <span class="nv">available</span> <span class="o">=</span> <span class="m">14</span>

The Job_slot_reservations are alive as long as this Application is alive!
<span class="o">(</span>press Enter to end<span class="o">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This application, jobSlotReservation, must be alive a long as your use-case is executing. So do not press ‘Enter’ as long as use cases is executing.</p>
</div>
<p>As a result of above command, file “/var/tmp/xilinx/xrm_jobReservation.sh” will be created. This file will have a unique reservation id for each JOB. Open this file and note down the “XRM_RESERVE_ID_#N” entries.</p>
<p>If the last such entry is XRM_RESERVE_ID_14, it means user launch 14 instances of this JOB in parallel.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each JOB must be launched in a separate shell. So as per example above, open 14 different shells and launch 14 instances as mentioned below.</p>
</div>
<p>For example, to start 1st instance of use-case, open a new shell and execute the commands mentioned below:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /opt/xilinx/xcdr/setup.sh
<span class="nb">source</span> /var/tmp/xilinx/xrm_jobReservation.sh
<span class="nb">export</span> <span class="nv">XRM_RESERVE_ID</span><span class="o">=</span><span class="si">${</span><span class="nv">XRM_RESERVE_ID_1</span><span class="si">}</span>
</pre></div>
</div>
<p>Then, launch the use case (GStreamer command) which matches the job description. Example GStreamer command is mentioned below:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>gst-launch-1.0 filesrc <span class="nv">location</span><span class="o">=</span>~/Videos/bbb_sunflower_1080p_60fps_normal.mp4 ! qtdemux <span class="se">\</span>
! h264parse <span class="se">\</span>
! vvas_xvcudec num-entropy-buf<span class="o">=</span><span class="m">2</span> xclbin-location<span class="o">=</span>/opt/xilinx/xcdr/xclbins/transcode.xclbin <span class="se">\</span>
! vvas_xvcuenc xclbin-location<span class="o">=</span>/opt/xilinx/xcdr/xclbins/transcode.xclbin target-bitrate<span class="o">=</span><span class="m">600</span> <span class="se">\</span>
! h264parse <span class="se">\</span>
! fpsdisplaysink <span class="nv">name</span><span class="o">=</span>fpssink video-sink<span class="o">=</span><span class="s2">&quot;fakesink&quot;</span> text-overlay<span class="o">=</span><span class="nb">false</span> <span class="nv">sync</span><span class="o">=</span><span class="nb">false</span> -v
</pre></div>
</div>
<p>User can repeat the same for 13 more such instances in each separate shell without worrying about ‘dev-idx’ parameter
on which command needs to be run.</p>
</div>
<div class="section" id="launcher">
<h3>Launcher<a class="headerlink" href="#launcher" title="Permalink to this heading">¶</a></h3>
<p>‘Launcher’ is another application which makes it much easier to run maximum multiple instances of a use-case without the knowledge of
number of devices available and how many are free to use. This is achieved with the help of XRM based ‘launcher’ application.</p>
<p>Steps to use:</p>
<ol class="arabic simple">
<li><p>After the device and host boots up, setup the environment:</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /opt/xilinx/xcdr/setup.sh
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Create a text file with the absolute path of the input stream needed for a use-case, including file name. There shall be one entry for each instance. In case you want to provide same file as input for all instances, then add same path and file name in each entry in the file. Otherwise provide the required filename with complete path for each instance.</p></li>
</ol>
<p>If, say, there are ‘N’ entries in the text file, and depending on the devices available and the load requirement of one instance/JOB, ‘Y’ instances can be launched simultaneously, then
If ‘N’ &lt;= ‘Y’ all ‘N’ instances will be launched in one go.
If ‘N’ &gt; ‘Y’, then first ‘Y’ instances will be launched quickly in one go. After that as soon as any of the instances is finished running, a new instance will be launched. This will continue as long as all ‘N’ instances are launched.</p>
<p>Example of such text file, source.txt is:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>/tmp/Videos/bbb_sunflower_1080p_60fps_normal.mp4
/tmp/Videos/bbb_sunflower_1080p_60fps_normal.mp4
/tmp/Videos/bbb_sunflower_1080p_60fps_normal.mp4
/tmp/Videos/bbb_sunflower_1080p_60fps_normal.mp4
</pre></div>
</div>
<p>3.  Create a text file with the command to be run. Example of such file, say run.txt is as below. Make sure to use matching
job description json file and the command. Examples of such run param files are located at: /opt/xilinx/launcher/scripts/vvas_run_params/</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">job_description</span> <span class="o">=</span> /opt/xilinx/launcher/scripts/describe_job/describe_job_h264_transcodeOnly_1080p60.json

<span class="nv">cmdline</span> <span class="o">=</span> gst-launch-1.0 filesrc <span class="se">\</span>
        ! qtdemux <span class="se">\</span>
        ! h264parse <span class="se">\</span>
        ! vvas_xvcudec num-entropy-buf<span class="o">=</span><span class="m">2</span> xclbin-location<span class="o">=</span>/opt/xilinx/xcdr/xclbins/transcode.xclbin <span class="se">\</span>
        ! queue max-size-buffers<span class="o">=</span><span class="m">1</span> <span class="se">\</span>
        ! vvas_xvcuenc xclbin-location<span class="o">=</span>/opt/xilinx/xcdr/xclbins/transcode.xclbin <span class="se">\</span>
        ! video/x-h264 <span class="se">\</span>
        ! fpsdisplaysink <span class="nv">name</span><span class="o">=</span>sink_xcode_maxresolution fps-update-interval<span class="o">=</span><span class="m">5000</span> video-sink<span class="o">=</span>fakesink text-overlay<span class="o">=</span><span class="nb">false</span> <span class="nv">sync</span><span class="o">=</span><span class="nb">false</span> -v
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Launch multiple instances</p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>launcher source.txt run.txt
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
				  
				  <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="transcoding.html" class="btn btn-neutral float-left" title="Basic Transcoding pipelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="xabrladder.html" class="btn btn-neutral float-right" title="GStreamer ABR Ladder Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, Advanced Micro Devices, Inc.
      <span class="lastupdated">Last updated on December 28, 2022.
      </span></p>
  </div>



										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">

													                    <div class="row">
                        <div class="col-xs-24">
                          <p><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a> | <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a> | <a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a> | <a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a> | <a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a> | <a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a> | <a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></p>
                        </div>
                    </div>
												</div>
											</div>
										</div>
										
</br>


  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>